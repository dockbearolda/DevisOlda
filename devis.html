<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demande de Devis | Atelier OLDA</title>
  <style>
    :root {
      --white: #ffffff;
      --gray-50: #f5f5f7;
      --gray-100: #e8e8ed;
      --gray-200: #d2d2d7;
      --gray-400: #86868b;
      --gray-600: #6e6e73;
      --gray-800: #1d1d1f;
      --blue: #0071e3;
      --blue-hover: #0077ed;
      --green: #34c759;
      --radius-md: 12px;
      --radius-xl: 22px;
      --radius-full: 50px;
      --shadow-md: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
      --transition-fast: 0.2s ease;
      --transition-medium: 0.4s ease;
      --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', Arial, sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font-family); background: var(--white); color: var(--gray-800); line-height: 1.5; }
    h1 { font-size: clamp(2rem, 5vw, 3rem); font-weight: 600; letter-spacing: -0.02em; }
    p { color: var(--gray-600); font-size: 1rem; }
    .header { position: fixed; top: 0; left: 0; right: 0; height: 52px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 22px; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .header-link { font-size: 0.875rem; color: var(--blue); text-decoration: none; }
    .main { padding-top: 52px; min-height: 100vh; }
    .stepper-container { position: sticky; top: 52px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); z-index: 100; padding: 20px 0; border-bottom: 1px solid rgba(0,0,0,0.08); }
    .stepper { display: flex; justify-content: center; align-items: center; max-width: 500px; margin: 0 auto; padding: 0 20px; }
    .step { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: var(--radius-full); cursor: pointer; }
    .step-number { width: 28px; height: 28px; border-radius: 50%; background: var(--gray-200); color: var(--gray-600); font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; justify-content: center; transition: all var(--transition-medium); }
    .step.active .step-number { background: var(--blue); color: var(--white); transform: scale(1.1); }
    .step.completed .step-number { background: var(--green); color: var(--white); }
    .step.completed .step-number::after { content: '‚úì'; }
    .step.completed .step-number span { display: none; }
    .step-label { font-size: 0.8rem; font-weight: 500; color: var(--gray-400); }
    .step.active .step-label { color: var(--gray-800); }
    .step-connector { width: 30px; height: 1px; background: var(--gray-200); margin: 0 4px; }
    .step-connector.completed { background: var(--green); }
    @media (max-width: 640px) { .step-label { display: none; } }
    .form-container { max-width: 680px; margin: 0 auto; padding: 50px 24px 100px; }
    .form-step { display: none; animation: fadeIn 0.5s ease; }
    .form-step.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .step-header { text-align: center; margin-bottom: 40px; }
    .step-header h1 { margin-bottom: 12px; }
    .form-group { margin-bottom: 20px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 480px) { .form-row { grid-template-columns: 1fr; } }
    .form-label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 8px; }
    .form-input { width: 100%; padding: 14px 18px; font-size: 1rem; border: 1px solid var(--gray-200); border-radius: var(--radius-md); background: var(--white); transition: all var(--transition-fast); outline: none; font-family: inherit; }
    .form-input:focus { border-color: var(--blue); box-shadow: 0 0 0 4px rgba(0,113,227,0.1); }
    textarea.form-input { resize: vertical; min-height: 100px; }
    .segmented-control { display: inline-flex; background: var(--gray-100); border-radius: var(--radius-md); padding: 4px; }
    .segment { padding: 10px 24px; font-size: 0.9rem; font-weight: 500; color: var(--gray-600); background: transparent; border: none; border-radius: 8px; cursor: pointer; font-family: inherit; }
    .segment.active { background: var(--white); color: var(--gray-800); box-shadow: var(--shadow-md); }
    .collection-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px; }
    @media (max-width: 768px) { .collection-grid { grid-template-columns: 1fr; } }
    .collection-card { background: var(--white); border-radius: var(--radius-xl); overflow: hidden; border: 2px solid transparent; cursor: pointer; transition: all var(--transition-medium); box-shadow: var(--shadow-md); position: relative; }
    .collection-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .collection-card.selected { border-color: var(--blue); }
    .card-images { display: grid; grid-template-columns: 1fr 1fr; height: 140px; overflow: hidden; }
    .card-images img { width: 100%; height: 100%; object-fit: cover; }
    .card-content { padding: 16px; }
    .card-badge { display: inline-block; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; padding: 4px 10px; border-radius: var(--radius-full); background: var(--gray-100); color: var(--gray-600); margin-bottom: 8px; }
    .card-content h3 { font-size: 1.1rem; margin-bottom: 4px; }
    .card-content p { font-size: 0.85rem; }
    .card-check { position: absolute; top: 10px; right: 10px; width: 24px; height: 24px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; opacity: 0; }
    .collection-card.selected .card-check { opacity: 1; }
    .options-section { margin-top: 24px; }
    .options-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; }
    .options-chips { display: flex; flex-wrap: wrap; gap: 10px; }
    .chip { padding: 10px 20px; font-size: 0.9rem; font-weight: 500; color: var(--gray-600); background: var(--gray-50); border: 1.5px solid var(--gray-200); border-radius: var(--radius-full); cursor: pointer; font-family: inherit; }
    .chip.active { background: rgba(0,113,227,0.08); border-color: var(--blue); color: var(--blue); }
    .color-section { margin-bottom: 30px; }
    .color-swatches { display: flex; gap: 12px; flex-wrap: wrap; }
    .color-swatch { width: 44px; height: 44px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all var(--transition-fast); box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1); }
    .color-swatch:hover { transform: scale(1.1); }
    .color-swatch.selected { border-color: var(--blue); transform: scale(1.15); }
    .color-swatch[data-color="white"] { background: #ffffff; }
    .color-swatch[data-color="black"] { background: #1d1d1f; }
    .color-swatch[data-color="navy"] { background: #0a3d62; }
    .color-swatch[data-color="gray"] { background: #8e8e93; }
    .color-swatch[data-color="red"] { background: #d63031; }
    .color-swatch[data-color="green"] { background: #00b894; }
    .color-label { font-size: 0.875rem; color: var(--gray-600); margin-top: 12px; }
    .size-section { margin-bottom: 30px; }
    .size-table-wrapper { overflow-x: auto; border-radius: var(--radius-md); border: 1px solid var(--gray-200); }
    .size-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    .size-table th, .size-table td { padding: 12px; text-align: center; border-bottom: 1px solid var(--gray-100); }
    .size-table th { background: var(--gray-50); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; }
    .size-table td:first-child { text-align: left; font-weight: 500; }
    .qty-input { width: 55px; padding: 8px; text-align: center; font-size: 0.9rem; border: 1px solid var(--gray-200); border-radius: 8px; font-family: inherit; }
    .qty-input:focus { outline: none; border-color: var(--blue); }
    .upload-section { margin-bottom: 30px; }
    .upload-zone { border: 2px dashed var(--gray-200); border-radius: var(--radius-xl); padding: 40px 24px; text-align: center; cursor: pointer; background: var(--gray-50); transition: all var(--transition-fast); }
    .upload-zone:hover { border-color: var(--blue); background: rgba(0,113,227,0.04); }
    .upload-zone.has-files { border-style: solid; border-color: var(--green); background: rgba(52,199,89,0.04); }
    .upload-icon { font-size: 2.5rem; margin-bottom: 12px; opacity: 0.6; }
    .upload-text { font-size: 1rem; color: var(--gray-800); margin-bottom: 6px; }
    .upload-hint { font-size: 0.85rem; color: var(--gray-400); }
    .upload-input { display: none; }
    .uploaded-files { margin-top: 16px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .uploaded-file { display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: var(--white); border-radius: var(--radius-full); font-size: 0.85rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .remove-file { width: 18px; height: 18px; border-radius: 50%; background: var(--gray-200); border: none; cursor: pointer; font-size: 0.7rem; color: var(--gray-600); }
    .remove-file:hover { background: #ff3b30; color: white; }
    .date-section { margin-bottom: 30px; }
    .date-input { width: 100%; max-width: 250px; padding: 14px 18px; font-size: 1rem; border: 1px solid var(--gray-200); border-radius: var(--radius-md); font-family: inherit; cursor: pointer; }
    .date-input:focus { outline: none; border-color: var(--blue); }
    .summary-section { background: var(--gray-50); border-radius: var(--radius-xl); padding: 20px; margin-bottom: 20px; }
    .summary-title { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-400); margin-bottom: 10px; }
    .summary-content p { color: var(--gray-800); margin-bottom: 4px; font-size: 0.9rem; }
    .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 480px) { .summary-grid { grid-template-columns: 1fr; } }
    .reassurance { background: linear-gradient(135deg, var(--gray-50), rgba(0,113,227,0.04)); border-radius: var(--radius-xl); padding: 24px; display: flex; align-items: flex-start; gap: 14px; margin-top: 30px; }
    .reassurance-icon { font-size: 1.5rem; }
    .reassurance p { font-size: 0.9rem; color: var(--gray-600); line-height: 1.6; }
    .form-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 40px; padding-top: 24px; border-top: 1px solid var(--gray-100); }
    .btn { padding: 14px 28px; font-size: 1rem; font-weight: 500; font-family: inherit; border-radius: var(--radius-full); cursor: pointer; transition: all var(--transition-fast); display: inline-flex; align-items: center; gap: 8px; }
    .btn-secondary { background: transparent; color: var(--blue); border: none; }
    .btn-secondary:hover { background: var(--gray-50); }
    .btn-primary { background: var(--blue); color: var(--white); border: none; box-shadow: var(--shadow-md); }
    .btn-primary:hover { background: var(--blue-hover); box-shadow: var(--shadow-lg); transform: translateY(-1px); }
    .btn-submit { background: linear-gradient(135deg, var(--blue), #34c759); padding: 16px 36px; font-size: 1.05rem; }
    .success-screen { display: none; text-align: center; padding: 80px 24px; animation: fadeIn 0.6s ease; }
    .success-screen.active { display: block; }
    .success-icon { width: 80px; height: 80px; background: linear-gradient(135deg, var(--green), #00c853); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 28px; font-size: 2.5rem; color: white; box-shadow: 0 8px 30px rgba(52,199,89,0.3); }
    .success-screen p { max-width: 400px; margin: 0 auto 28px; }
    .back-home { display: inline-flex; align-items: center; gap: 8px; color: var(--blue); text-decoration: none; font-weight: 500; font-size: 1rem; }
    .loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 2000; }
    .loading-overlay.active { display: flex; }
    .loading-spinner { width: 44px; height: 44px; border: 3px solid var(--gray-200); border-top-color: var(--blue); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <header class="header">
    <a href="/" class="header-link">‚Üê Retour boutique</a>
    <a href="/" class="header-link">OLDA</a>
  </header>
  <main class="main">
    <div class="stepper-container">
      <nav class="stepper">
        <div class="step active" data-step="1"><span class="step-number"><span>1</span></span><span class="step-label">Identit√©</span></div>
        <div class="step-connector"></div>
        <div class="step" data-step="2"><span class="step-number"><span>2</span></span><span class="step-label">Collection</span></div>
        <div class="step-connector"></div>
        <div class="step" data-step="3"><span class="step-number"><span>3</span></span><span class="step-label">Personnalisation</span></div>
        <div class="step-connector"></div>
        <div class="step" data-step="4"><span class="step-number"><span>4</span></span><span class="step-label">Finalisation</span></div>
      </nav>
    </div>
    <div class="form-container">
      <section class="form-step active" data-step="1">
        <div class="step-header"><h1>Parlez-nous de vous</h1><p>Ces informations nous aideront √† personnaliser votre devis.</p></div>
        <div class="form-group"><label class="form-label">Vous √™tes</label><div class="segmented-control"><button type="button" class="segment active" data-type="professionnel">Professionnel</button><button type="button" class="segment" data-type="particulier">Particulier</button></div></div>
        <div class="form-row"><div class="form-group"><label class="form-label">Nom *</label><input type="text" id="lastName" class="form-input" placeholder="Dupont" required></div><div class="form-group"><label class="form-label">Pr√©nom *</label><input type="text" id="firstName" class="form-input" placeholder="Marie" required></div></div>
        <div class="form-group"><label class="form-label">Soci√©t√© (optionnel)</label><input type="text" id="company" class="form-input" placeholder="Nom de votre entreprise"></div>
        <div class="form-group"><label class="form-label">Email *</label><input type="email" id="email" class="form-input" placeholder="marie@exemple.fr" required></div>
        <div class="form-group"><label class="form-label">T√©l√©phone *</label><input type="tel" id="phone" class="form-input" placeholder="06 12 34 56 78" required></div>
        <div class="form-group"><label class="form-label">D√©crivez votre projet</label><textarea id="projectDesc" class="form-input" placeholder="Uniformes pour mon restaurant, tenues √©v√©nement..."></textarea></div>
        <div class="form-nav"><div></div><button type="button" class="btn btn-primary" onclick="goToStep(2)">Continuer ‚Üí</button></div>
      </section>
      <section class="form-step" data-step="2">
        <div class="step-header"><h1>Choisissez votre textile</h1><p>Des mati√®res s√©lectionn√©es pour leur qualit√©.</p></div>
        <div class="collection-grid">
          <div class="collection-card" data-collection="entree"><div class="card-check">‚úì</div><div class="card-images"><img src="https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=200&h=140&fit=crop" alt=""><img src="https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=200&h=140&fit=crop" alt=""></div><div class="card-content"><span class="card-badge">180g</span><h3>Entr√©e de gamme</h3><p>Id√©al restauration, √©v√©nementiel</p></div></div>
          <div class="collection-card" data-collection="milieu"><div class="card-check">‚úì</div><div class="card-images"><img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=200&h=140&fit=crop" alt=""><img src="https://images.unsplash.com/photo-1618354691373-d851c5c3a990?w=200&h=140&fit=crop" alt=""></div><div class="card-content"><span class="card-badge">220g</span><h3>Milieu de gamme</h3><p>Confort quotidien, robuste</p></div></div>
          <div class="collection-card" data-collection="haut"><div class="card-check">‚úì</div><div class="card-images"><img src="https://images.unsplash.com/photo-1576566588028-4147f3842f27?w=200&h=140&fit=crop" alt=""><img src="https://images.unsplash.com/photo-1554568218-0f1715e72254?w=200&h=140&fit=crop" alt=""></div><div class="card-content"><span class="card-badge">250g</span><h3>Haut de gamme</h3><p>Premium, coupe mode, durable</p></div></div>
        </div>
        <div class="options-section"><div class="options-title">Options sp√©cifiques</div><div class="options-chips"><button type="button" class="chip" data-option="exterieur">Travail ext√©rieur</button><button type="button" class="chip" data-option="lycra">Lycra / Stretch</button><button type="button" class="chip" data-option="bio">Coton bio</button><button type="button" class="chip" data-option="recycle">Mati√®res recycl√©es</button></div></div>
        <div class="form-nav"><button type="button" class="btn btn-secondary" onclick="goToStep(1)">‚Üê Retour</button><button type="button" class="btn btn-primary" onclick="goToStep(3)">Continuer ‚Üí</button></div>
      </section>
      <section class="form-step" data-step="3">
        <div class="step-header"><h1>Personnalisez</h1><p>Couleurs, tailles et marquage.</p></div>
        <div class="color-section"><label class="form-label">Couleur principale</label><div class="color-swatches"><button type="button" class="color-swatch selected" data-color="white" title="Blanc"></button><button type="button" class="color-swatch" data-color="black" title="Noir"></button><button type="button" class="color-swatch" data-color="navy" title="Bleu marine"></button><button type="button" class="color-swatch" data-color="gray" title="Gris"></button><button type="button" class="color-swatch" data-color="red" title="Rouge"></button><button type="button" class="color-swatch" data-color="green" title="Vert"></button></div><p class="color-label">S√©lectionn√© : <strong id="selectedColorName">Blanc</strong></p></div>
        <div class="size-section"><label class="form-label">Quantit√©s par taille</label><div class="size-table-wrapper"><table class="size-table"><thead><tr><th></th><th>S</th><th>M</th><th>L</th><th>XL</th><th>XXL</th></tr></thead><tbody><tr><td>Homme</td><td><input type="number" class="qty-input" data-gender="homme" data-size="S" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="homme" data-size="M" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="homme" data-size="L" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="homme" data-size="XL" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="homme" data-size="XXL" min="0" value="0"></td></tr><tr><td>Femme</td><td><input type="number" class="qty-input" data-gender="femme" data-size="S" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="femme" data-size="M" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="femme" data-size="L" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="femme" data-size="XL" min="0" value="0"></td><td><input type="number" class="qty-input" data-gender="femme" data-size="XXL" min="0" value="0"></td></tr></tbody></table></div></div>
        <div class="upload-section"><label class="form-label">Votre logo ou visuels</label><div class="upload-zone" id="uploadZone"><div class="upload-icon">üìÅ</div><p class="upload-text">Glissez vos fichiers ici ou cliquez</p><p class="upload-hint">PNG, JPG, PDF (max 10 Mo)</p><input type="file" class="upload-input" id="fileInput" multiple accept=".png,.jpg,.jpeg,.pdf"><div class="uploaded-files" id="uploadedFiles"></div></div></div>
        <div class="form-nav"><button type="button" class="btn btn-secondary" onclick="goToStep(2)">‚Üê Retour</button><button type="button" class="btn btn-primary" onclick="goToStep(4)">Continuer ‚Üí</button></div>
      </section>
      <section class="form-step" data-step="4">
        <div class="step-header"><h1>Finalisez</h1><p>V√©rifiez et envoyez votre demande.</p></div>
        <div class="summary-grid"><div class="summary-section"><div class="summary-title">Contact</div><div class="summary-content" id="summaryContact"></div></div><div class="summary-section"><div class="summary-title">Collection</div><div class="summary-content" id="summaryCollection"></div></div></div>
        <div class="summary-section"><div class="summary-title">Personnalisation</div><div class="summary-content" id="summaryCustom"></div></div>
        <div class="date-section"><label class="form-label">Date de livraison souhait√©e</label><input type="date" class="date-input" id="deliveryDate"></div>
        <div class="form-group"><label class="form-label">Remarques (optionnel)</label><textarea id="additionalNotes" class="form-input" placeholder="Informations suppl√©mentaires..."></textarea></div>
        <div class="reassurance"><span class="reassurance-icon">üíé</span><p>Afin de cerner au mieux votre demande et vous proposer le tarif le plus juste, ces informations nous sont pr√©cieuses. Notre √©quipe vous recontactera sous 24-48h.</p></div>
        <div class="form-nav"><button type="button" class="btn btn-secondary" onclick="goToStep(3)">‚Üê Retour</button><button type="button" class="btn btn-primary btn-submit" onclick="submitQuote()">Envoyer ma demande ‚ú®</button></div>
      </section>
      <section class="success-screen" id="successScreen"><div class="success-icon">‚úì</div><h1>Demande envoy√©e !</h1><p>Merci pour votre confiance. Notre √©quipe vous recontactera rapidement avec un devis personnalis√©.</p><a href="/" class="back-home">‚Üê Retour √† la boutique</a></section>
    </div>
  </main>
  <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div></div>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    let currentStep = 1;
    let formData = { type: 'professionnel', lastName: '', firstName: '', company: '', email: '', phone: '', projectDesc: '', collection: null, options: [], color: 'white', sizes: { homme: {S:0,M:0,L:0,XL:0,XXL:0}, femme: {S:0,M:0,L:0,XL:0,XXL:0} }, files: [], deliveryDate: '', additionalNotes: '' };
    const colorNames = { white: 'Blanc', black: 'Noir', navy: 'Bleu marine', gray: 'Gris', red: 'Rouge', green: 'Vert' };
    const collectionNames = { entree: 'Entr√©e de gamme (180g)', milieu: 'Milieu de gamme (220g)', haut: 'Haut de gamme (250g)' };
    emailjs.init('skJW2Ge2SH15HZXNp');
    function goToStep(step) {
      if (step > currentStep && !validateStep(currentStep)) return;
      saveFormData(); currentStep = step; updateStepperUI(); showStep(step);
      if (step === 4) updateSummary();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function validateStep(step) {
      if (step === 1) {
        const ln = document.getElementById('lastName').value.trim();
        const fn = document.getElementById('firstName').value.trim();
        const em = document.getElementById('email').value.trim();
        const ph = document.getElementById('phone').value.trim();
        if (!ln || !fn || !em || !ph) { alert('Veuillez remplir tous les champs obligatoires.'); return false; }
        if (!em.includes('@')) { alert('Email invalide.'); return false; }
      }
      return true;
    }
    function saveFormData() {
      formData.lastName = document.getElementById('lastName').value.trim();
      formData.firstName = document.getElementById('firstName').value.trim();
      formData.company = document.getElementById('company').value.trim();
      formData.email = document.getElementById('email').value.trim();
      formData.phone = document.getElementById('phone').value.trim();
      formData.projectDesc = document.getElementById('projectDesc').value.trim();
      formData.deliveryDate = document.getElementById('deliveryDate').value;
      formData.additionalNotes = document.getElementById('additionalNotes').value.trim();
      document.querySelectorAll('.qty-input').forEach(input => { formData.sizes[input.dataset.gender][input.dataset.size] = parseInt(input.value) || 0; });
    }
    function updateStepperUI() {
      document.querySelectorAll('.step').forEach((el, i) => { el.classList.remove('active', 'completed'); if (i + 1 < currentStep) el.classList.add('completed'); else if (i + 1 === currentStep) el.classList.add('active'); });
      document.querySelectorAll('.step-connector').forEach((el, i) => { el.classList.toggle('completed', i < currentStep - 1); });
    }
    function showStep(step) { document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active')); document.querySelector('.form-step[data-step="' + step + '"]').classList.add('active'); }
    function updateSummary() {
      document.getElementById('summaryContact').innerHTML = '<p><strong>' + formData.firstName + ' ' + formData.lastName + '</strong></p>' + (formData.company ? '<p>' + formData.company + '</p>' : '') + '<p>' + formData.email + '</p><p>' + formData.phone + '</p>';
      document.getElementById('summaryCollection').innerHTML = formData.collection ? '<p><strong>' + collectionNames[formData.collection] + '</strong></p>' + (formData.options.length ? '<p>Options : ' + formData.options.join(', ') + '</p>' : '') : '<p style="color:#86868b">Non s√©lectionn√©e</p>';
      let totalQty = 0, sizeDetails = [];
      ['homme', 'femme'].forEach(g => { Object.entries(formData.sizes[g]).forEach(([s, q]) => { if (q > 0) { sizeDetails.push((g === 'homme' ? 'H' : 'F') + ' ' + s + ': ' + q); totalQty += q; } }); });
      document.getElementById('summaryCustom').innerHTML = '<p><strong>Couleur :</strong> ' + colorNames[formData.color] + '</p><p><strong>Quantit√© :</strong> ' + totalQty + ' pi√®ces</p>' + (sizeDetails.length ? '<p style="font-size:0.85rem">' + sizeDetails.join(' ‚Ä¢ ') + '</p>' : '') + (formData.files.length ? '<p><strong>Fichiers :</strong> ' + formData.files.length + '</p>' : '');
    }
    async function submitQuote() {
      saveFormData();
      let totalQty = 0, sizeBreakdown = [];
      ['homme', 'femme'].forEach(g => { Object.entries(formData.sizes[g]).forEach(([s, q]) => { if (q > 0) { sizeBreakdown.push((g === 'homme' ? 'Homme' : 'Femme') + ' ' + s + ': ' + q); totalQty += q; } }); });
      const orderNumber = 'DEVIS-' + Math.random().toString(36).substring(2, 8).toUpperCase();
      const emailParams = { to_email: 'atelieroldacommande@gmail.com', order_number: orderNumber, customer_name: formData.firstName + ' ' + formData.lastName, customer_email: formData.email, order_details: 'DEMANDE DE DEVIS TEXTILE - ' + orderNumber + '\n\nClient: ' + formData.firstName + ' ' + formData.lastName + '\n' + (formData.company ? 'Soci√©t√©: ' + formData.company + '\n' : '') + 'Email: ' + formData.email + '\nT√©l: ' + formData.phone + '\nType: ' + formData.type + '\n\nProjet: ' + (formData.projectDesc || 'Non renseign√©') + '\n\nCollection: ' + (formData.collection ? collectionNames[formData.collection] : 'Non s√©lectionn√©e') + '\n' + (formData.options.length ? 'Options: ' + formData.options.join(', ') + '\n' : '') + '\nCouleur: ' + colorNames[formData.color] + '\nQuantit√©: ' + totalQty + ' pi√®ces\n' + (sizeBreakdown.length ? 'Tailles:\n' + sizeBreakdown.join('\n') + '\n' : '') + '\nDate souhait√©e: ' + (formData.deliveryDate || 'Non pr√©cis√©e') + '\nRemarques: ' + (formData.additionalNotes || 'Aucune') };
      document.getElementById('loadingOverlay').classList.add('active');
      try {
        await emailjs.send('service_o3r7snn', 'template_sqg7vz2', emailParams);
        document.getElementById('loadingOverlay').classList.remove('active');
        document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));
        document.getElementById('successScreen').classList.add('active');
        document.querySelector('.stepper-container').style.display = 'none';
      } catch (e) { document.getElementById('loadingOverlay').classList.remove('active'); alert('Erreur. R√©essayez.'); console.error(e); }
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.segment').forEach(btn => btn.addEventListener('click', () => { document.querySelectorAll('.segment').forEach(b => b.classList.remove('active')); btn.classList.add('active'); formData.type = btn.dataset.type; }));
      document.querySelectorAll('.collection-card').forEach(card => card.addEventListener('click', () => { document.querySelectorAll('.collection-card').forEach(c => c.classList.remove('selected')); card.classList.add('selected'); formData.collection = card.dataset.collection; }));
      document.querySelectorAll('.chip').forEach(chip => chip.addEventListener('click', () => { chip.classList.toggle('active'); const opt = chip.textContent; if (chip.classList.contains('active')) formData.options.push(opt); else formData.options = formData.options.filter(o => o !== opt); }));
      document.querySelectorAll('.color-swatch').forEach(sw => sw.addEventListener('click', () => { document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected')); sw.classList.add('selected'); formData.color = sw.dataset.color; document.getElementById('selectedColorName').textContent = colorNames[formData.color]; }));
      const uploadZone = document.getElementById('uploadZone'), fileInput = document.getElementById('fileInput'), uploadedFiles = document.getElementById('uploadedFiles');
      uploadZone.addEventListener('click', () => fileInput.click());
      uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.style.borderColor = '#0071e3'; });
      uploadZone.addEventListener('dragleave', () => { uploadZone.style.borderColor = ''; });
      uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.style.borderColor = ''; handleFiles(e.dataTransfer.files); });
      fileInput.addEventListener('change', () => handleFiles(fileInput.files));
      function handleFiles(files) { Array.from(files).forEach(f => { if (f.size <= 10*1024*1024) formData.files.push(f.name); }); updateFileList(); }
      function updateFileList() { if (formData.files.length) { uploadZone.classList.add('has-files'); uploadedFiles.innerHTML = formData.files.map((n, i) => '<div class="uploaded-file"><span>üìÑ ' + n + '</span><button type="button" class="remove-file" onclick="removeFile(' + i + ')">√ó</button></div>').join(''); } else { uploadZone.classList.remove('has-files'); uploadedFiles.innerHTML = ''; } }
      window.removeFile = i => { formData.files.splice(i, 1); updateFileList(); };
      const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1); document.getElementById('deliveryDate').min = tomorrow.toISOString().split('T')[0];
      document.querySelectorAll('.step').forEach(el => el.addEventListener('click', () => { const n = parseInt(el.dataset.step); if (n < currentStep) goToStep(n); }));
    });
  </script>
</body>
</html>
