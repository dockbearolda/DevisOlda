<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OLDA | Production Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Bebas+Neue&display=swap');
        @font-face { font-family: 'EDO'; src: url('https://fonts.cdnfonts.com/s/14871/Edo.woff') format('woff'); }
        @font-face { font-family: 'Rodeo'; src: url('https://fonts.cdnfonts.com/s/15456/Rodeo.woff') format('woff'); }

        body { font-family: 'Inter', sans-serif; background-color: #f8f8fa; color: #1d1d1f; }
        .apple-card { background: white; border-radius: 20px; border: 1px solid rgba(0,0,0,0.06); }
        .input-apple { background: #f5f5f7; border: 1px solid #d2d2d7; border-radius: 12px; padding: 12px; font-size: 14px; width: 100%; outline: none; }

        .color-dot { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; border: 1px solid #d2d2d7; transition: 0.2s; }
        .color-dot.active { border: 2px solid #0071e3; transform: scale(1.2); }

        @media print {
            @page { size: A6; margin: 0; }
            .no-print { display: none !important; }
            .fiche-a6 { 
                width: 105mm; height: 148mm; padding: 10mm; margin: 0;
                display: flex; flex-direction: column; justify-content: space-between;
                page-break-after: always; text-align: center; border: none !important;
            }
        }

        .step-pill { font-[900] text-[7px] uppercase tracking-tighter px-2 py-2 rounded-full border transition-all cursor-pointer flex-1 text-center; }
        .step-active { background: #000; color: #fff; border-color: #000; }
        .step-inactive { background: #f5f5f7; color: #a1a1a6; border-color: #e5e5e7; }

        .font-edo { font-family: 'EDO', sans-serif; line-height: 1; }
        .font-bebas { font-family: 'Bebas Neue', cursive; line-height: 1; }
        .font-rodeo { font-family: 'Rodeo', sans-serif; line-height: 1; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-xl mx-auto no-print">
        <header class="mb-8 border-b pb-4 flex justify-between items-center">
            <h1 class="text-2xl font-[900] tracking-tighter uppercase">OLDA <span class="text-blue-600 font-normal text-xs ml-2 italic">SYSTEM</span></h1>
            <button onclick="window.print()" class="text-[10px] font-black border px-4 py-2 rounded-full uppercase">Imprimer Tout</button>
        </header>

        <div class="apple-card p-6 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Client</label>
                    <input type="text" id="client" class="input-apple font-bold uppercase" placeholder="NOM">
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Genre</label>
                    <select id="genre" class="input-apple font-bold" onchange="updateRefs()">
                        <option value="H">HOMME</option>
                        <option value="F">FEMME</option>
                        <option value="E">ENFANT</option>
                        <option value="B">BÉBÉ</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Référence</label>
                    <select id="refOlda" class="input-apple font-bold"></select>
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Taille</label>
                    <select id="taille" class="input-apple font-bold">
                        <option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option>
                    </select>
                </div>
            </div>

            <div class="p-4 bg-gray-50 rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-2"><span class="text-[10px] font-black uppercase text-blue-600 italic">Configuration Avant</span> <span id="vAv" class="text-[10px] font-bold">60mm</span></div>
                <select id="logoAv" class="input-apple font-bold" onchange="toggleBox('Av')">
                    <option value="SANS">SANS LOGO</option>
                    <option value="PERSONNALISATION">TEXTE PERSO</option>
                    <option value="LOGO CLIENT">LOGO CLIENT (IMAGE)</option>
                    <option value="BEA-16AV">BEA-16AV</option>
                </select>
                <div id="boxAv" class="hidden space-y-2">
                    <input type="text" id="textAv" class="input-apple" placeholder="Texte...">
                    <select id="fontAv" class="input-apple text-xs">
                        <option value="font-bebas">Bebas Neue Bold</option>
                        <option value="font-edo">EDO</option>
                        <option value="font-rodeo">Rodeo</option>
                    </select>
                    <input type="file" id="fileAv" class="hidden text-[10px]" accept="image/*">
                </div>
                <input type="range" id="sizeAv" min="0" max="120" value="60" class="w-full accent-black" oninput="document.getElementById('vAv').innerText=this.value+'mm'">
                <div class="flex flex-wrap gap-2 justify-center" id="palAv"></div>
            </div>

            <div class="p-4 bg-gray-50 rounded-xl space-y-4">
                <div class="flex justify-between items-center border-b pb-2"><span class="text-[10px] font-black uppercase text-blue-600 italic">Configuration Arrière</span> <span id="vAr" class="text-[10px] font-bold">250mm</span></div>
                <select id="logoAr" class="input-apple font-bold" onchange="toggleBox('Ar')">
                    <option value="SANS">SANS LOGO</option>
                    <option value="PERSONNALISATION">TEXTE PERSO</option>
                    <option value="LOGO CLIENT">LOGO CLIENT (IMAGE)</option>
                    <option value="BEA-16AR">BEA-16AR</option>
                </select>
                <div id="boxAr" class="hidden space-y-2">
                    <input type="text" id="textAr" class="input-apple" placeholder="Texte...">
                    <select id="fontAr" class="input-apple text-xs">
                        <option value="font-bebas">Bebas Neue Bold</option>
                        <option value="font-edo">EDO</option>
                        <option value="font-rodeo">Rodeo</option>
                    </select>
                    <input type="file" id="fileAr" class="hidden text-[10px]" accept="image/*">
                </div>
                <input type="range" id="sizeAr" min="0" max="350" value="250" class="w-full accent-black" oninput="document.getElementById('vAr').innerText=this.value+'mm'">
                <div class="flex flex-wrap gap-2 justify-center" id="palAr"></div>
            </div>

            <button onclick="createFiche()" class="w-full bg-black text-white py-5 rounded-2xl font-black uppercase tracking-[0.2em] shadow-xl">Générer Fiche A6</button>
        </div>
    </div>

    <div id="orderList" class="mt-12 flex flex-col items-center gap-10 pb-20"></div>

    <script>
        const colorPalette = [
            {n:'Noir', v:'#000'}, {n:'Blanc', v:'#fff'}, {n:'Beige', v:'#f5f5dc'},
            {n:'Rouge', v:'#f00'}, {n:'Marine', v:'#000080'}, {n:'Violet', v:'#8f00ff'},
            {n:'Menthe', v:'#98ff98'}, {n:'Jaune', v:'#ffeb3b'}, {n:'Rose', v:'#ffb7ce'},
            {n:'Kaki', v:'#c3b091'}, {n:'Vert', v:'#008000'}
        ];
        
        let selections = { Av: { color: '#000', name: 'Noir' }, Ar: { color: '#000', name: 'Noir' } };

        function updateRefs() {
            const g = document.getElementById('genre').value;
            const rs = document.getElementById('refOlda');
            rs.innerHTML = '';
            for(let i=1; i<=20; i++) {
                let v = `${g}-${i.toString().padStart(3,'0')}`;
                rs.add(new Option(v, v));
            }
        }

        function init() {
            ['Av', 'Ar'].forEach(pos => {
                const pal = document.getElementById(`pal${pos}`);
                colorPalette.forEach(col => {
                    const d = document.createElement('div');
                    d.className = `color-dot ${col.n === 'Noir' ? 'active' : ''}`;
                    d.style.backgroundColor = col.v;
                    if(col.n === 'Blanc') d.style.border = "1px solid #ddd";
                    d.onclick = () => {
                        pal.querySelectorAll('.color-dot').forEach(x => x.classList.remove('active'));
                        d.classList.add('active');
                        selections[pos] = { color: col.v, name: col.n };
                    };
                    pal.appendChild(d);
                });
            });
            updateRefs();
        }

        function toggleBox(pos) {
            const v = document.getElementById(`logo${pos}`).value;
            document.getElementById(`box${pos}`).classList.toggle('hidden', v === 'SANS' || v.startsWith('BEA'));
            document.getElementById(`text${pos}`).classList.toggle('hidden', v !== 'PERSONNALISATION');
            document.getElementById(`font${pos}`).classList.toggle('hidden', v !== 'PERSONNALISATION');
            document.getElementById(`file${pos}`).classList.toggle('hidden', v !== 'LOGO CLIENT');
        }

        async function createFiche() {
            const client = document.getElementById('client').value || "CLIENT";
            const orderId = Math.floor(Math.random() * 9000);
            const fiche = document.createElement('div');
            fiche.className = "fiche-a6 apple-card shadow-2xl p-10 text-center";

            const renderContent = async (pos) => {
                const type = document.getElementById(`logo${pos}`).value;
                const size = document.getElementById(`size${pos}`).value;
                const hex = selections[pos].color;
                let html = '';

                if(type === 'PERSONNALISATION') {
                    html = `<p class="${document.getElementById(`font${pos}`).value}" style="color: ${hex}; font-size: 32pt;">${document.getElementById(`text${pos}`).value || 'TEXTE'}</p>`;
                } else if(type === 'LOGO CLIENT') {
                    const f = document.getElementById(`file${pos}`).files[0];
                    if(f) {
                        const url = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(f); });
                        html = `<img src="${url}" class="mx-auto" style="max-height: 35mm; max-width: 90%; object-fit: contain;">`;
                    }
                } else if(type !== 'SANS') {
                    html = `<p class="font-black italic tracking-tighter" style="color: ${hex}; font-size: 36pt;">${type}</p>`;
                }
                return `<div class="py-4 border-b border-gray-50"><span class="text-[7px] font-black opacity-30 uppercase block mb-2">${pos} — ${size}mm</span>${html}</div>`;
            };

            fiche.innerHTML = `
                <div class="mb-4">
                    <h2 class="text-5xl font-[900] tracking-tighter leading-none">${client.toUpperCase()}</h2>
                    <p class="text-blue-600 text-[10px] font-black uppercase mt-1 tracking-widest">${document.getElementById('refOlda').value} — TAILLE ${document.getElementById('taille').value}</p>
                </div>
                ${await renderContent('Av')}
                ${await renderContent('Ar')}
                <div class="no-print mt-6 flex gap-1 pt-4 border-t" id="s-${orderId}">
                    <div class="step-pill step-active" onclick="setStep('${orderId}', 0)">Attente</div>
                    <div class="step-pill step-inactive" onclick="setStep('${orderId}', 1)">Réception</div>
                    <div class="step-pill step-inactive" onclick="setStep('${orderId}', 2)">Production</div>
                    <div class="step-pill step-inactive" onclick="setStep('${orderId}', 3)">Terminé</div>
                </div>
                <button onclick="this.closest('.fiche-a6').remove()" class="no-print text-[8px] opacity-20 mt-4 uppercase font-bold">Supprimer de la session</button>
            `;
            document.getElementById('orderList').prepend(fiche);
        }

        function setStep(id, idx) {
            const pills = document.getElementById(`s-${id}`).querySelectorAll('.step-pill');
            pills.forEach((p, i) => p.className = i <= idx ? "step-pill step-active" : "step-pill step-inactive");
        }

        init();
    </script>
</body>
</html>
