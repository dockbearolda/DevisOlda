<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OLDA | Production A6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;900&family=Bebas+Neue&display=swap');
        @font-face { font-family: 'EDO'; src: url('https://fonts.cdnfonts.com/s/14871/Edo.woff') format('woff'); }
        @font-face { font-family: 'Rodeo'; src: url('https://fonts.cdnfonts.com/s/15456/Rodeo.woff') format('woff'); }

        body { font-family: 'Inter', sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
        .apple-card { background: white; border-radius: 15px; border: 1px solid rgba(0,0,0,0.1); }
        .input-apple { background: #fbfbfd; border: 1px solid #d2d2d7; border-radius: 8px; padding: 10px; font-size: 14px; width: 100%; outline: none; }
        
        /* Polices */
        .font-edo { font-family: 'EDO', sans-serif; }
        .font-bebas { font-family: 'Bebas Neue', cursive; }
        .font-rodeo { font-family: 'Rodeo', sans-serif; }
        
        /* Couleurs */
        .dot-noir { background: #000; } .dot-blanc { background: #fff; border: 1px solid #ddd; } 
        .dot-beige { background: #f5f5dc; } .dot-jaune { background: #ffeb3b; }
        .dot-bleu-clair { background: #add8e6; } .dot-bleu-marine { background: #000080; }
        .dot-vert { background: #008000; } .dot-vert-pastel { background: #77dd77; }
        .dot-lavande { background: #e6e6fa; } .dot-violet { background: #8f00ff; }
        .dot-kaki { background: #c3b091; } .dot-vert-clair { background: #90ee90; }
        .dot-menthe { background: #98ff98; } .dot-rose-bebe { background: #ffb7ce; } .dot-rouge { background: #f00; }
        
        .color-dot { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; border: 1px solid #d2d2d7; transition: 0.2s; }
        .color-dot.active { border: 2px solid #0071e3; transform: scale(1.2); }

        /* FORMAT A6 - IMPRESSION */
        @media print {
            @page { size: A6; margin: 0; }
            body { background: white; padding: 0; margin: 0; }
            .no-print { display: none !important; }
            .fiche-a6 { 
                width: 105mm; height: 148mm; 
                padding: 8mm; margin: 0;
                display: flex; flex-direction: column;
                justify-content: space-between;
                page-break-after: always;
            }
        }

        .logo-img { max-width: 80%; max-height: 40mm; object-fit: contain; margin: 0 auto; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-xl mx-auto no-print">
        <header class="mb-6 flex justify-between items-center">
            <h1 class="text-2xl font-black italic">OLDA PRODUCTION</h1>
            <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded-full text-xs font-bold uppercase">Imprimer Fiche</button>
        </header>

        <div class="apple-card p-6 space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="client" class="input-apple font-bold uppercase" placeholder="CLIENT">
                <select id="refOlda" class="input-apple font-bold"></select>
            </div>

            <div class="grid grid-cols-2 gap-4 border-t pt-4">
                <div>
                    <label class="text-[10px] font-bold text-blue-600 uppercase">Avant (Max 120mm)</label>
                    <select id="logoAv" class="input-apple mt-1" onchange="toggleBox('Av')">
                        <option value="SANS">AUCUN</option>
                        <option value="PERSONNALISATION">TEXTE</option>
                        <option value="LOGO CLIENT">LOGO CLIENT</option>
                        <option value="BEA-16AV">BEA-16AV</option>
                    </select>
                    <input type="file" id="fileAv" class="hidden text-[10px] mt-2" accept="image/*">
                    <input type="text" id="textAv" class="hidden input-apple mt-2" placeholder="Texte...">
                    <select id="fontAv" class="hidden input-apple mt-1">
                        <option value="font-bebas">Bebas Neue</option>
                        <option value="font-edo">EDO</option>
                        <option value="font-rodeo">Rodeo</option>
                    </select>
                    <input type="range" id="sizeAv" min="0" max="120" value="60" class="w-full mt-2 accent-blue-600">
                </div>

                <div>
                    <label class="text-[10px] font-bold text-blue-600 uppercase">Arrière (Max 350mm)</label>
                    <select id="logoAr" class="input-apple mt-1" onchange="toggleBox('Ar')">
                        <option value="SANS">AUCUN</option>
                        <option value="PERSONNALISATION">TEXTE</option>
                        <option value="LOGO CLIENT">LOGO CLIENT</option>
                        <option value="BEA-16AR">BEA-16AR</option>
                    </select>
                    <input type="file" id="fileAr" class="hidden text-[10px] mt-2" accept="image/*">
                    <input type="text" id="textAr" class="hidden input-apple mt-2" placeholder="Texte...">
                    <select id="fontAr" class="hidden input-apple mt-1">
                        <option value="font-bebas">Bebas Neue</option>
                        <option value="font-edo">EDO</option>
                        <option value="font-rodeo">Rodeo</option>
                    </select>
                    <input type="range" id="sizeAr" min="0" max="350" value="250" class="w-full mt-2 accent-blue-600">
                </div>
            </div>

            <div class="border-t pt-4">
                <label class="text-[10px] font-bold uppercase mb-2 block">Couleur de Marquage</label>
                <div id="colorContainer" class="flex flex-wrap gap-2"></div>
            </div>

            <button onclick="generateFiche()" class="w-full bg-black text-white py-4 rounded-xl font-black uppercase tracking-widest">Générer Fiche A6</button>
        </div>
    </div>

    <div id="output" class="mt-8 flex flex-col items-center gap-6"></div>

    <script>
        const colors = [
            {n:'Noir', c:'dot-noir'}, {n:'Blanc', c:'dot-blanc'}, {n:'Beige', c:'dot-beige'},
            {n:'Rouge', c:'dot-rouge'}, {n:'Marine', c:'dot-bleu-marine'}, {n:'Violet', c:'dot-violet'}
        ];
        let selectedColor = 'Noir';

        function toggleBox(pos) {
            const v = document.getElementById(`logo${pos}`).value;
            document.getElementById(`text${pos}`).classList.toggle('hidden', v !== 'PERSONNALISATION');
            document.getElementById(`font${pos}`).classList.toggle('hidden', v !== 'PERSONNALISATION');
            document.getElementById(`file${pos}`).classList.toggle('hidden', v !== 'LOGO CLIENT');
        }

        const colorContainer = document.getElementById('colorContainer');
        colors.forEach(col => {
            const div = document.createElement('div');
            div.className = `color-dot ${col.c} ${col.n === 'Noir' ? 'active' : ''}`;
            div.onclick = () => {
                document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                div.classList.add('active');
                selectedColor = col.n;
            };
            colorContainer.appendChild(div);
        });

        const ref = document.getElementById('refOlda');
        for(let i=1; i<=15; i++) ref.add(new Option(`H-${i.toString().padStart(3,'0')}`, `H-${i.toString().padStart(3,'0')}`));

        async function generateFiche() {
            const client = document.getElementById('client').value || "CLIENT";
            const ref = document.getElementById('refOlda').value;
            
            const card = document.createElement('div');
            card.className = "fiche-a6 apple-card text-center shadow-lg";

            const buildSection = async (pos, title) => {
                const type = document.getElementById(`logo${pos}`).value;
                const size = document.getElementById(`size${pos}`).value;
                let content = '';

                if(type === 'PERSONNALISATION') {
                    content = `<p class="text-2xl font-black ${document.getElementById(`font${pos}`).value}">${document.getElementById(`text${pos}`).value}</p>`;
                } else if(type === 'LOGO CLIENT') {
                    const file = document.getElementById(`file${pos}`).files[0];
                    if(file) {
                        const url = await new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });
                        content = `<img src="${url}" class="logo-img">`;
                    }
                } else {
                    content = `<p class="text-3xl font-black uppercase italic">${type}</p>`;
                }

                return `
                    <div class="flex flex-col items-center justify-center border-t py-4">
                        <span class="text-[8px] font-black uppercase opacity-40 mb-2">${title} — ${size}mm</span>
                        <div class="h-20 flex items-center justify-center w-full">${content}</div>
                    </div>
                `;
            };

            card.innerHTML = `
                <div class="mb-4">
                    <h2 class="text-4xl font-[900] tracking-tighter leading-none mb-1">${client.toUpperCase()}</h2>
                    <p class="text-[10px] font-black text-blue-600 tracking-widest">${ref}</p>
                </div>
                ${await buildSection('Av', 'Position Avant')}
                ${await buildSection('Ar', 'Position Arrière')}
                <div class="mt-4 pt-2 border-t border-dashed">
                    <p class="text-[10px] font-black uppercase italic">Couleur Marquage : ${selectedColor}</p>
                </div>
                <button onclick="this.closest('.fiche-a6').remove()" class="no-print text-[8px] opacity-20 mt-2 uppercase">Supprimer</button>
            `;
            document.getElementById('output').prepend(card);
        }
    </script>
</body>
</html>
