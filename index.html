<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Atelier OLDA | Management Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
        .apple-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 24px; border: 1px solid rgba(0,0,0,0.05); }
        .input-apple { background: #ffffff; border: 1.5px solid #d2d2d7; border-radius: 12px; padding: 10px; width: 100%; font-size: 14px; outline: none; }
        .famille-urgent { background-color: #ff3b30 !important; color: white !important; }
        .famille-urgent * { color: white !important; }
        .logo-display { font-size: 10px; font-weight: 800; color: #0071e3; margin-top: 5px; text-transform: uppercase; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-start mb-8 no-print">
            <div>
                <h1 class="text-3xl font-black italic tracking-tighter">ATELIER <span class="text-blue-600">OLDA</span></h1>
                <p class="text-gray-400 text-[10px] font-bold uppercase tracking-widest">M√©lina Dashboard ‚Äî Saint-Martin</p>
            </div>
            <button onclick="toggleUrgency()" id="urgentBtn" class="bg-gray-200 text-[10px] font-black px-5 py-2 rounded-full uppercase transition-all">Priorit√© : Normale</button>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
            
            <div class="xl:col-span-5 no-print">
                <div class="apple-card p-6 shadow-2xl border-t-8 border-blue-500">
                    <p class="text-blue-600 font-bold italic mb-6">M√©lina, qui est le client ?</p>
                    
                    <form id="orderForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="text" id="client" class="input-apple font-bold" placeholder="Nom du Client" required>
                            <input type="tel" id="phone" class="input-apple" placeholder="WhatsApp (ex: 0690...)" required>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                            <div class="grid grid-cols-3 gap-2">
                                <div>
                                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">R√©f√©rence</label>
                                    <select id="refOlda" class="input-apple text-[11px] font-bold">
                                        </select>
                                </div>
                                <div>
                                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Taille</label>
                                    <select id="taille" class="input-apple text-[11px]">
                                        <option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option>
                                        <option>2 ans</option><option>4 ans</option><option>6 ans</option><option>8 ans</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-[9px] font-black uppercase opacity-40 ml-1">Quantit√©</label>
                                    <input type="number" id="qty" class="input-apple text-center" value="1" min="1">
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-white rounded-2xl border-2 border-dashed border-gray-200">
                            <p class="text-[9px] font-black text-gray-400 uppercase mb-4 text-center">Position & Choix des Logos</p>
                            
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div class="flex flex-col items-center">
                                    <div class="w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center text-xl mb-1 border">üëï</div>
                                    <label class="text-[8px] font-bold">AVANT G</label>
                                    <select id="selectLogoAvG" class="input-apple text-[9px] mt-1 p-1" onchange="updateVisual('displayAvG', this.value)">
                                        <option value="">Aucun</option>
                                        <option value="BEA-16AV">BEA-16AV</option>
                                        <option value="SUR-07AV">SUR-07AV</option>
                                    </select>
                                    <div id="displayAvG" class="logo-display"></div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div class="w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center text-xl mb-1 border">üëï</div>
                                    <label class="text-[8px] font-bold">AVANT D</label>
                                    <select id="selectLogoAvD" class="input-apple text-[9px] mt-1 p-1" onchange="updateVisual('displayAvD', this.value)">
                                        <option value="">Aucun</option>
                                        <option value="BEA-16AV">BEA-16AV</option>
                                        <option value="SUR-07AV">SUR-07AV</option>
                                    </select>
                                    <div id="displayAvD" class="logo-display"></div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <div class="w-14 h-14 bg-gray-100 rounded-xl flex items-center justify-center text-xl mb-1 border shadow-inner">üß•</div>
                                    <label class="text-[8px] font-bold">ARRI√àRE</label>
                                    <select id="selectLogoAr" class="input-apple text-[9px] mt-1 p-1" onchange="updateVisual('displayAr', this.value)">
                                        <option value="">Aucun</option>
                                        <option value="BEA-16AR">BEA-16AR</option>
                                        <option value="PAY-01">PAY-01</option>
                                        <option value="VIN-01 ROUGE">VIN-01 ROUGE</option>
                                        <option value="VIN-01 NOIR">VIN-01 NOIR</option>
                                    </select>
                                    <div id="displayAr" class="logo-display"></div>
                                </div>
                            </div>
                        </div>

                        <select id="type" class="input-apple font-bold text-blue-600">
                            <option value="tshirt">üëï T-shirt</option>
                            <option value="pochette">üëù Pochette</option>
                            <option value="tasse">‚òï Tasse</option>
                            <option value="loic">üëë Demande Lo√Øc</option>
                        </select>

                        <button type="submit" class="w-full bg-black text-white py-4 rounded-2xl font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all">Transmettre √† l'Atelier</button>
                    </form>
                </div>
            </div>

            <div class="xl:col-span-7">
                <div id="orderList" class="grid grid-cols-1 gap-6"></div>
            </div>
        </div>
    </div>

    <script>
        // G√©n√©ration des r√©f√©rences 1 √† 15
        const refSelect = document.getElementById('refOlda');
        const typesOlda = ['H', 'F', 'E', 'B'];
        typesOlda.forEach(t => {
            for(let i=1; i<=15; i++) {
                let val = `${t}-${i.toString().padStart(3, '0')}`;
                let opt = document.createElement('option');
                opt.value = val; opt.text = val;
                refSelect.add(opt);
            }
        });

        let isUrgent = false;
        function toggleUrgency() {
            isUrgent = !isUrgent;
            document.getElementById('urgentBtn').innerText = isUrgent ? "Priorit√© : URGENTE" : "Priorit√© : Normale";
            document.getElementById('urgentBtn').className = isUrgent ? "bg-red-600 text-white text-[10px] font-black px-5 py-2 rounded-full uppercase" : "bg-gray-200 text-black text-[10px] font-black px-5 py-2 rounded-full uppercase";
        }

        function updateVisual(id, val) {
            document.getElementById(id).innerText = val;
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const now = new Date();
            const orderId = `2026-${document.getElementById('client').value.toUpperCase().replace(/\s/g, '').substring(0,4)}-${now.getDate()}${now.getMonth()+1}-${now.getHours()}h${now.getMinutes()}`;
            
            const card = document.createElement('div');
            card.id = `card-${orderId}`;
            card.className = `apple-card p-6 shadow-xl ${isUrgent ? 'famille-urgent' : 'bg-white'} animate-in slide-in-from-right duration-500`;
            
            const logos = `AV.G: ${document.getElementById('selectLogoAvG').value || '-'} | AV.D: ${document.getElementById('selectLogoAvD').value || '-'} | AR: ${document.getElementById('selectLogoAr').value || '-'}`;

            card.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <span class="text-[9px] font-black opacity-40 uppercase">${orderId}</span>
                        <h3 class="text-3xl font-black tracking-tighter uppercase">${document.getElementById('client').value}</h3>
                        <p class="text-sm font-bold opacity-70 italic">${document.getElementById('qty').value}x ${document.getElementById('refOlda').value} ‚Äî Taille ${document.getElementById('taille').value}</p>
                    </div>
                    ${isUrgent ? '<span class="bg-white text-red-600 font-black px-3 py-1 rounded shadow-lg animate-pulse">URGENT</span>' : ''}
                </div>

                <div class="bg-black/5 p-5 rounded-3xl mb-6 flex justify-around items-center border border-black/5">
                    <div class="text-center"><p class="text-[8px] font-black opacity-30">AV. G</p><p class="text-xs font-bold">${document.getElementById('selectLogoAvG').value || '-'}</p></div>
                    <div class="text-center"><p class="text-[8px] font-black opacity-30">AV. D</p><p class="text-xs font-bold">${document.getElementById('selectLogoAvD').value || '-'}</p></div>
                    <div class="text-center"><p class="text-[8px] font-black opacity-30">ARRI√àRE</p><p class="text-xs font-bold">${document.getElementById('selectLogoAr').value || '-'}</p></div>
                </div>

                <div class="flex gap-4 no-print">
                    <button onclick="downloadPDF('${orderId}')" class="flex-1 bg-blue-600 text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest shadow-lg">Enregistrer PDF</button>
                    <button onclick="sendWhatsApp('${document.getElementById('phone').value}', '${document.getElementById('client').value}', '${orderId}')" class="flex-1 bg-green-500 text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest shadow-lg">WhatsApp Client</button>
                </div>

                <div class="mt-6 pt-4 border-t border-black/5 flex justify-between items-center text-[10px] font-black opacity-30">
                    <span>${now.toLocaleString()}</span>
                    <button onclick="this.closest('.apple-card').remove()" class="no-print hover:text-red-600">ARCHIVER ‚úì</button>
                </div>
            `;
            document.getElementById('orderList').prepend(card);
            form.reset();
            document.querySelectorAll('.logo-display').forEach(d => d.innerText = '');
            if(isUrgent) toggleUrgency();
        });

        function downloadPDF(id) {
            const element = document.getElementById(`card-${id}`);
            html2pdf().from(element).set({ margin: 10, filename: `OLDA_${id}.pdf`, jsPDF: { unit: 'mm', format: 'a4' } }).save();
        }

        function sendWhatsApp(phone, client, id) {
            const msg = `Bonjour ${client}, votre commande OLDA n¬∞${id} est pr√™te √† l'atelier ! ‚ú®`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
